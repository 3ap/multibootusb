for isofile in $isopath/systemrescuecd-*.iso; do
  if [ -e "$isofile" ]; then
    regexp --set=isoname "$isopath/(.*)" "$isofile"
    submenu "$isoname ->" "$isofile" {
      iso_path="$2"
      loopback loop "$iso_path"
      bootoptions="img_dev=$imgdevpath img_loop=$iso_path earlymodules=loop archisobasedir=sysresccd archisolabel=SYSRCD601"
      menuentry "Default boot options" {
        linux (loop)/sysresccd/boot/x86_64/vmlinuz $bootoptions scandelay=1
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "All files cached to memory (copytoram)" {
        linux (loop)/sysresccd/boot/x86_64/vmlinuz $bootoptions copytoram
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Framebuffer console in high resolution" {
        linux (loop)/sysresccd/boot/x86_64/vmlinuz $bootoptions nomodeset vga=791
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Boot an existing Linux system installed on the disk" {
        linux (loop)/sysresccd/boot/x86_64/vmlinuz $bootoptions root=auto
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Directly start the graphical environment" {
        linux (loop)/sysresccd/boot/x86_64/vmlinuz $bootoptions dostartx
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "MEMTEST: Memory test using Memtest86+" {
        bootoptions="-"
        linux16 (loop)/sysresccd/boot/memtest $bootoptions
      }
    }
  fi
done
