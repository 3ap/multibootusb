for isofile in $isopath/systemrescuecd-*.iso; do
  if [ -e "$isofile" ]; then
    regexp --set=isoname "$isopath/(.*)" "$isofile"
    submenu "$isoname ->" "$isofile" {
      iso_path="$2"
      loopback loop "$iso_path"
      menuentry "Default boot options" {
        bootoptions="isoloop=$iso_path scandelay=1"
        linux (loop)/sysresccd/boot/x86_64/vmlinuz archisobasedir=sysresccd archisolabel=SYSRCD601 $bootoptions
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "All files cached to memory (copytoram)" {
        bootoptions="isoloop=$iso_path copytoram"
        linux (loop)/sysresccd/boot/x86_64/vmlinuz archisobasedir=sysresccd archisolabel=SYSRCD601 $bootoptions
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Framebuffer console in high resolution" {
        bootoptions="isoloop=$iso_path nomodeset vga=791"
        linux (loop)/sysresccd/boot/x86_64/vmlinuz archisobasedir=sysresccd archisolabel=SYSRCD601 $bootoptions
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Boot an existing Linux system installed on the disk" {
        bootoptions="isoloop=$iso_path root=auto"
        linux (loop)/sysresccd/boot/x86_64/vmlinuz archisobasedir=sysresccd archisolabel=SYSRCD601 $bootoptions
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "Directly start the graphical environment" {
        bootoptions="isoloop=$iso_path dostartx"
        linux (loop)/sysresccd/boot/x86_64/vmlinuz archisobasedir=sysresccd archisolabel=SYSRCD601 $bootoptions
        initrd (loop)/sysresccd/boot/intel_ucode.img (loop)/sysresccd/boot/amd_ucode.img (loop)/sysresccd/boot/x86_64/sysresccd.img
      }
      menuentry "MEMTEST: Memory test using Memtest86+" {
        bootoptions="-"
        linux16 (loop)/sysresccd/boot/memtest $bootoptions
      }
    }
  fi
done
